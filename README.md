# gokalkan

[![pkg-img]][pkg-url]
[![reportcard-img]][reportcard-url]

<img src="https://user-images.githubusercontent.com/29381624/170255957-56b2c349-c04f-4ec8-9054-78bbe351fcc8.png" width=100>

–ü–∞–∫–µ—Ç `gokalkan` —è–≤–ª—è–µ—Ç—Å—è –æ–±–µ—Ä—Ç–∫–æ–π –Ω–∞–¥ –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ KalkanCrypt.

KalkanCrypt —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≠–¶–ü –∫–ª—é—á–∞–º–∏ –æ—Ç pki.gov.kz –∏
–ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –≤—ã—Ç–∞—Å–∫–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –º–Ω–æ–≥–æ —á–µ–≥–æ –¥—Ä—É–≥–æ–≥–æ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ
—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å—è–º–∏, —Ü–∏—Ñ—Ä–æ–≤—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–∞ `gokalkan`:

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
- –ë–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ß–∏—Å—Ç—ã–π –∫–æ–¥
- –ù–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã KalkanCrypt

## –ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É:

#### 1. –ü–æ–ª—É—á–∏—Ç—å SDK

–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ [pki.gov.kz](https://pki.gov.kz/developers/) —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å SDK. SDK –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è –Ω–∞–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è Java –∏ C.

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ª–µ–∂–∞—Ç –ø–æ –ø—É—Ç–∏ `SDK/C/Linux/ca-certs/Ubuntu`. –í –ø–∞–ø–∫–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–≤–∞ —Ç–∏–ø–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ - `production` –∏ `test`. –î–ª—è –∏—Ö —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è sudo –ø—Ä–∞–≤–∞.

#### 3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .so —Ñ–∞–π–ª—ã

–§–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `SDK/C/Linux/C`. –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```sh
sudo cp -f libkalkancryptwr-64.so libkalkancryptwr-64.so.1.1.0 /usr/lib/
```

#### 4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å kalkancrypt

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É `SDK/C/Linux/libs_for_linux/kalkancrypt` –≤ `/opt/`:

```sh
sudo cp -r kalkancrypt /opt/
```

#### 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ kalkancrypt

```sh
sudo chmod -R 555 /opt/kalkancrypt
```

#### 6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `gokalkan` —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```sh
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/kalkancrypt/:/opt/kalkancrypt/lib/engines
```

–≠—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω—É–∂–Ω–∞ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ KalkanCrypt.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–í–µ—Ä—Å–∏—è Go 1.17+

```sh
go get github.com/gokalkan/gokalkan
```

## –ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ PKCS12

–ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –∫–ª—é—á–æ–º –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä –≠–¶–ü –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `RSA...`):

```go
package main

import (
	"fmt"
	"log"

	"github.com/gokalkan/gokalkan"
)

var (
	certPath = "test_cert/GOSTKNCA.p12" // –ø—É—Ç—å –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É

	certPassword = "Qwerty12" // –ø–∞—Ä–æ–ª—å
	// P.S. –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥–µ
)

func main() {
	// –¥–ª—è —Ç–µ—Å—Ç–∞
	opts := gokalkan.OptsTest

	// –¥–ª—è –ø—Ä–æ–¥–∞
	// opts := gokalkan.OptsProd

	cli, err = gokalkan.NewClient(opts...)
	if err != nil {
		log.Fatal("new kalkan client create error", err)
	}
	// –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç, –∏–Ω–∞—á–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —É—Ç–µ—á–∫–∞–º —Ä–µ—Å—É—Ä—Å–æ–≤
	defer cli.Close()

	// –ü–æ–¥–≥—Ä—É–∂–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –ø–∞—Ä–æ–ª–µ–º
	err = cli.LoadKeyStore(certPath, certPassword)
	if err != nil {
		log.Fatal("load key store error", err)
	}
}
```

–°–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ gokalkan –∫–ª–∏–µ–Ω—Ç–∞ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø—Ü–∏—é.
–ï—Å—Ç—å –¥–≤–µ –æ–ø—Ü–∏–∏ - `OptsTest` –∏ `OptsProd`. –ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω—É –∏–∑ –Ω–∏—Ö –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è.

### –ü–æ–¥–ø–∏—Å—å XML –¥–æ–∫—É–º–µ–Ω—Ç–∞

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å XML –¥–æ–∫—É–º–µ–Ω—Ç, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏:

```go
signedXML, err := cli.SignXML("<root>GoKalkan</root>")

fmt.Println("–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π XML", signedXML)
fmt.Println("–û—à–∏–±–∫–∞", err)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ XML –¥–æ–∫—É–º–µ–Ω—Ç–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–µ–≤–µ—Ä–Ω–æ –ª–∏–±–æ —Å—Ä–æ–∫
—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å –∫–æ—Ç–æ—Ä—ã–º –ø–æ–¥–ø–∏—Å–∞–Ω –∏—Å—Ç—ë–∫.

```go
serial, err := cli.VerifyXML(signedXML)

fmt.Println("–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä", serial)
fmt.Println("–û—à–∏–±–∫–∞", err)
```

### –ü–æ–¥–ø–∏—Å—å XML –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è SmartBridge

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å XML –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ SignWSSE, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.
–§—É–Ω–∫—Ü–∏—è –æ–±–µ—Ä–Ω–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ `soap:Envelope` –∏ –∑–∞–ø–∏—à–µ—Ç –≤–Ω—É—Ç—Ä–∏ `soap:Body`.

```go
signedXML, err := cli.SignWSSE("<root>GoKalkan</root>")

fmt.Println("–ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π XML –≤ —Ñ–æ—Ä–º–∞—Ç–µ WSSE", signedXML)
fmt.Println("–û—à–∏–±–∫–∞", err)
```

## –ë–µ–Ω—á–º–∞—Ä–∫–∏

–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –±–µ–Ω—á–º–∞—Ä–∫–∞:

```sh
go test -bench SignXML -run=^$ -benchmem
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ö–æ—Å—Ç –º–∞—à–∏–Ω—ã:

- goos: linux
- goarch: amd64
- cpu: Intel(R) Core(TM) i5-8500 CPU @ 3.00GHz

| –ë–µ–Ω—á–º–∞—Ä–∫           | –ö–æ–ª-–≤–æ —Ü–∏–∫–ª–æ–≤ | –°—Ä–µ–¥–Ω. –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –°—Ä–µ–¥–Ω. –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –û–ó–£ | –°—Ä–µ–¥–Ω. –∫–æ–ª-–≤–æ –∞–ª–ª–æ–∫–∞—Ü–∏–π |
| ------------------ | ------------- | ----------------------- | ---------------------- | ----------------------- |
| BenchmarkSignXML-6 | 2809          | 422310 ns/op            | 2792 B/op              | 8 allocs/op             |

## Contributors ‚ú®

C–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->

<table>
	<tr>
		<td align="center">
			<a href="https://github.com/atlekbai">
				<img src="https://avatars.githubusercontent.com/u/29381624?v=4&s=100" width="100px;" alt=""/><br />
				<sub><b>Tlekbai Ali</b></sub>
			</a><br />
			<a href="https://github.com/gokalkan/gokalkan/commits?author=atlekbai" title="Code">üíª</a>
		</td>
		<td align="center">
			<a href="https://github.com/gammban">
				<img src="https://avatars.githubusercontent.com/u/98373125?v=4s=100" width="100px;" alt=""/><br />
				<sub><b>Kilibayev Azat</b></sub>
			</a><br />
			<a href="https://github.com/gokalkan/gokalkan/commits?author=gammban" title="Code">üíª</a>
		</td>
	</tr>
</table>

<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->

<!-- ALL-CONTRIBUTORS-LIST:END -->

## License

The MIT License (MIT) 2021 - [Abylaikhan Zulbukharov](https://github.com/Zulbukharov).

Please have a look at the [LICENSE.md](https://github.com/Zulbukharov/kalkancrypt-wrapper/blob/master/LICENSE.md) for more details.

[pkg-img]: https://pkg.go.dev/badge/Zulbukharov/GoKalkan
[pkg-url]: https://pkg.go.dev/github.com/gokalkan/gokalkan
[reportcard-img]: https://goreportcard.com/badge/Zulbukharov/GoKalkan
[reportcard-url]: https://goreportcard.com/report/Zulbukharov/GoKalkan
